dist: trusty
language: python
python:
  - 2.7
env:
  - TEST=dynet
  - TEST=chainer
  - TEST=theano
matrix:
  include:
    - env: TEST=dynet-cpp
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - boost-latest
          packages:
            - g++-4.8
            - libboost-regex1.55-dev
      install:
        - hg clone https://bitbucket.org/eigen/eigen -r 699b659
        - git clone https://github.com/clab/dynet
        - export DYNET_PATH=$PWD/dynet EIGEN_PATH=$PWD/eigen
        - mkdir dynet/build
        - cd dynet/build
        - cmake .. -DEIGEN3_INCLUDE_DIR=$TRAVIS_BUILD_DIR/eigen
        - make -j$(nproc)
        - cd $TRAVIS_BUILD_DIR/dynet-cpp
        - make DYNET_PATH=$DYNET_PATH EIGEN_PATH=$EIGEN_PATH
        - cd $TRAVIS_BUILD_DIR

install:
  - pip install -q cython numpy
  - pip install $TEST

script:
  - env DYFLAGS="--dynet-mem 2048" TIMEOUT=30 LONGTIMEOUT=60 ./run-tests.sh
  - grep '\(per_sec\|startup\)' log/*/*.log

after_failure:
  - cat $TRAVIS_BUILD_DIR/log/*/*.log

